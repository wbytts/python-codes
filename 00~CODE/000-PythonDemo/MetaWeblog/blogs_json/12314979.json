{'dateCreated': <DateTime '20200215T22:38:00' at 0x1a4f2580088>, 'description': '![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214407022-53321036.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214417280-2111027943.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214437658-731981484.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214446316-1912566984.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214454074-2029603748.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214507950-950585637.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214515937-1128093809.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215214522787-1343221649.png)\n![](https://img2018.cnblogs.com/blog/1446249/202002/1446249-20200215223724750-1369792247.png)\n\n```c++\n#include <opencv2/opencv.hpp>\n#include <iostream>\n\nusing namespace cv;\nusing namespace std;\nRNG rng(12345);\n\nvoid ccl_stats_demo(Mat& image);\n\nint main(int argc, char** argv)\n{\n    Mat src = imread("f:/images/qq/20200215213837.png");\n    if (src.empty())\n    {\n        printf("Could not find the image!\\n");\n        return -1;\n    }\n\n    namedWindow("input", WINDOW_AUTOSIZE);\n    imshow("input", src);\n    \n    // 做一个高斯模糊，消除一些细微的东西\n    GaussianBlur(src, src, Size(3, 3), 0);\n    GaussianBlur(src, src, Size(3, 3), 0);\n\n    Mat gray, binary;\n    cvtColor(src, gray, COLOR_BGR2GRAY);\n    imshow("gray", gray);\n\n    threshold(gray, binary, 0, 255, THRESH_BINARY | THRESH_OTSU);\n    imshow("binary", binary);\n\n    // 获取联通组件，没有附加信息的\n    /*\n    Mat labels = Mat::zeros(binary.size(), CV_32S);\n    int num_labels = connectedComponents(binary, labels, 8, CV_32S);\n    printf("total labels: %d\\n", num_labels-1);\n    vector<Vec3b> colorTable(num_labels);\n    // background color\n    colorTable[0] = Vec3b(0, 0, 0);\n    for (int i = 1; i < num_labels; i++) {\n        colorTable[i] = Vec3b(rng.uniform(0, 256), rng.uniform(0, 256), rng.uniform(0, 256));\n    }\n\n    Mat result = Mat::zeros(src.size(), src.type());\n    int w = result.cols;\n    int h = result.rows;\n    for (int row = 0; row < h; row++) {\n        for (int col = 0; col < w; col++) {\n            int label = labels.at<int>(row, col);\n            result.at<Vec3b>(row, col) = colorTable[label];\n        }\n    }\n    putText(result, \n        format("number: %d", num_labels - 1), \n        Point(50, 50), FONT_HERSHEY_PLAIN, 1.0, \n        Scalar(0, 255, 0), 1);\n    imshow("CCL demo", result);\n    */\n\n    // 获取联通组件，有附加信息\n    ccl_stats_demo(binary);\n\n    waitKey(0);\n    destroyAllWindows();\n\n    return 0;\n}\n\nvoid ccl_stats_demo(Mat& image) {\n    Mat labels = Mat::zeros(image.size(), CV_32S);\n    Mat stats, centroids;\n    int num_labels = connectedComponentsWithStats(image, labels, stats, centroids, 8, CV_32S, CCL_DEFAULT);\n    printf("total labels: %d\\n", num_labels - 1);\n    vector<Vec3b> colorTable(num_labels);\n    // background color\n    colorTable[0] = Vec3b(0, 0, 0);\n    for (int i = 1; i < num_labels; i++) {\n        colorTable[i] = Vec3b(rng.uniform(0, 256), rng.uniform(0, 256), rng.uniform(0, 256));\n    }\n\n    // 注意这里的result的类型\n    Mat result = Mat::zeros(image.size(), CV_8UC3);\n    int w = result.cols;\n    int h = result.rows;\n    for (int row = 0; row < h; row++) {\n        for (int col = 0; col < w; col++) {\n            int label = labels.at<int>(row, col);\n            result.at<Vec3b>(row, col) = colorTable[label];\n        }\n    }\n    for (int i = 1; i < num_labels; i++) {\n        // 获取中心位置\n        int cx = centroids.at<double>(i, 0);\n        int cy = centroids.at<double>(i, 1);\n        // 获取外接矩形 和面积\n        int x = stats.at<int>(i, CC_STAT_LEFT);\n        int y = stats.at<int>(i, CC_STAT_TOP);\n        int width = stats.at<int>(i, CC_STAT_WIDTH);\n        int height = stats.at<int>(i, CC_STAT_HEIGHT);\n        // 这个面积的单位是像素\n        int area = stats.at<int>(i, CC_STAT_AREA); \n        // 绘制中心位置\n        circle(result, Point(cx, cy), 3, Scalar(0, 0, 255), 2, 8, 0);\n        // 绘制外接矩形\n        Rect box(x, y, width, height);\n        rectangle(result, box, Scalar(0, 255, 0), 2, 8, 0);\n        putText(result,\n            format("%d", area),\n            Point(x, y), FONT_HERSHEY_PLAIN, 1.0,\n            Scalar(0, 255, 0), 1);\n    }\n    \n    putText(result,\n        format("number: %d", num_labels - 1),\n        Point(50, 50), FONT_HERSHEY_PLAIN, 1.0,\n        Scalar(0, 255, 0), 1);\n    imshow("CCL demo", result);\n}\n\n```', 'title': 'opencv：联通组件扫描', 'categories': ['[随笔分类]OpenCV'], 'enclosure': {'length': 0}, 'link': 'https://www.cnblogs.com/wbyixx/p/12314979.html', 'permalink': 'https://www.cnblogs.com/wbyixx/p/12314979.html', 'postid': '12314979', 'source': {}, 'userid': '-2'}